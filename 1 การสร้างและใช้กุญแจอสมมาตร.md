# แล็บปฏิบัติการเรื่องโครงสร้างพื้นฐานกุญแจสาธารณะ (Public Key Infrastructure)
## ระยะเวลา: 1 ชั่วโมง

---

## วัตถุประสงค์
เมื่อเสร็จสิ้นแล็บนี้ นักศึกษาจะสามารถ:
1. เข้าใจแนวคิดพื้นฐานของโครงสร้างพื้นฐานกุญแจสาธารณะ (PKI)
2. อธิบายความแตกต่างระหว่างกุญแจแบบสมมาตรและอสมมาตร
3. สร้างและใช้งานคู่กุญแจสาธารณะ/ส่วนตัว
4. สร้างและตรวจสอบลายมือชื่อดิจิทัล
5. เข้าใจการทำงานของใบรับรองดิจิทัล (Digital Certificate)

---

## เนื้อหาและกิจกรรม

### ส่วนที่ 1: บทนำและแนวคิดพื้นฐาน (15 นาที)

#### 1.1 การเข้ารหัสแบบดั้งเดิม
การเข้ารหัสคือกระบวนการแปลงข้อมูลให้อยู่ในรูปแบบที่ไม่สามารถอ่านได้โดยผู้ที่ไม่ได้รับอนุญาต ในอดีต เราใช้การเข้ารหัสแบบสมมาตร (Symmetric Encryption) เท่านั้น

**การเข้ารหัสแบบสมมาตร** คือ การใช้กุญแจเดียวกันสำหรับทั้งการเข้ารหัสและถอดรหัส

ข้อดี:
- รวดเร็วและมีประสิทธิภาพ

ข้อเสีย:
- ต้องแบ่งปันกุญแจลับผ่านช่องทางที่ปลอดภัย
- ยากที่จะจัดการกุญแจจำนวนมาก
- ไม่สามารถทำลายมือชื่อดิจิทัลได้

#### 1.2 ปัญหาการแลกเปลี่ยนกุญแจ (Key Exchange Problem)
- ถ้าอลิซและบ็อบต้องการสื่อสารอย่างปลอดภัย พวกเขาต้องแบ่งปันกุญแจลับร่วมกัน
- แต่ถ้าพวกเขาไม่มีช่องทางการสื่อสารที่ปลอดภัยอยู่แล้ว พวกเขาจะสามารถแบ่งปันกุญแจได้อย่างไร?
- นี่คือที่มาของการเข้ารหัสแบบอสมมาตร

#### 1.3 การเข้ารหัสแบบอสมมาตร (Asymmetric Encryption)
- ใช้คู่กุญแจ: กุญแจสาธารณะและกุญแจส่วนตัว
- กุญแจสาธารณะ: ใช้สำหรับเข้ารหัส เผยแพร่สู่สาธารณะได้
- กุญแจส่วนตัว: ใช้สำหรับถอดรหัส เก็บเป็นความลับ
- ข้อความที่เข้ารหัสด้วยกุญแจสาธารณะจะถอดรหัสได้เฉพาะด้วยกุญแจส่วนตัวที่จับคู่กัน

**กิจกรรม:** ให้นักศึกษาจับคู่และอธิบายแนวคิดการเข้ารหัสแบบสมมาตรและอสมมาตรให้เพื่อนฟัง (5 นาที)

---

### ส่วนที่ 2: การเข้ารหัสแบบอสมมาตรในทางปฏิบัติ (20 นาที)

#### 2.1 การสร้างคู่กุญแจด้วย OpenSSL
เราจะใช้ OpenSSL เพื่อสร้างคู่กุญแจ RSA:

```bash
# สร้างกุญแจส่วนตัว RSA ขนาด 2048 บิต
openssl genrsa -out private_key.pem 2048

# สกัดกุญแจสาธารณะจากกุญแจส่วนตัว
openssl rsa -in private_key.pem -pubout -out public_key.pem
```

**กิจกรรม:** ให้นักศึกษาสร้างคู่กุญแจของตนเอง (5 นาที)

#### 2.2 การเข้ารหัสและถอดรหัสข้อความ
```bash
# เข้ารหัสข้อความด้วยกุญแจสาธารณะ
echo "ข้อความลับ" > message.txt
openssl rsautl -encrypt -pubin -inkey public_key.pem -in message.txt -out encrypted.bin

# ถอดรหัสข้อความด้วยกุญแจส่วนตัว
openssl rsautl -decrypt -inkey private_key.pem -in encrypted.bin -out decrypted.txt
```

**กิจกรรม:** ให้นักศึกษาจับคู่กัน แลกเปลี่ยนกุญแจสาธารณะและส่งข้อความที่เข้ารหัสแล้วให้กัน จากนั้นถอดรหัสข้อความที่ได้รับ (10 นาที)

---

### ส่วนที่ 3: ลายมือชื่อดิจิทัล (Digital Signatures) (15 นาที)

#### 3.1 แนวคิดพื้นฐาน
- ลายมือชื่อดิจิทัลทำงานในทิศทางตรงกันข้ามกับการเข้ารหัส
- ใช้กุญแจส่วนตัวเพื่อ "ลงนาม" ในข้อความ
- ใช้กุญแจสาธารณะเพื่อ "ตรวจสอบ" ลายมือชื่อ
- รับประกันความถูกต้องและความเป็นเจ้าของข้อความ

#### 3.2 การสร้างและตรวจสอบลายมือชื่อ
```bash
# สร้างแฮชและลงนามในไฟล์
echo "ข้อความสำคัญที่ต้องการลงนาม" > document.txt
openssl dgst -sha256 -sign private_key.pem -out signature.bin document.txt

# ตรวจสอบลายมือชื่อ
openssl dgst -sha256 -verify public_key.pem -signature signature.bin document.txt
```

**กิจกรรม:** ให้นักศึกษาสร้างเอกสาร ลงนามด้วยกุญแจส่วนตัว และให้เพื่อนตรวจสอบลายมือชื่อด้วยกุญแจสาธารณะ จากนั้นแก้ไขเอกสารเล็กน้อยและสังเกตว่าการตรวจสอบจะล้มเหลว (10 นาที)

---

### ส่วนที่ 4: โครงสร้างพื้นฐานกุญแจสาธารณะ (PKI) และใบรับรอง (10 นาที)

#### 4.1 ปัญหาความเชื่อถือ
- เมื่อได้รับกุญแจสาธารณะ เราจะรู้ได้อย่างไรว่าเป็นของผู้ที่อ้างว่าเป็นเจ้าของจริง?
- ถ้าอีฟ (ผู้ไม่ประสงค์ดี) ส่งกุญแจสาธารณะของเธอแทนกุญแจของบ็อบ?

#### 4.2 PKI และหน่วยรับรอง (Certificate Authority - CA)
- PKI คือระบบที่สร้างความเชื่อใจผ่านบุคคลที่สาม คือ หน่วยรับรอง (CA)
- CA ออกใบรับรองดิจิทัลที่ยืนยันความเป็นเจ้าของของกุญแจสาธารณะ
- ใบรับรองประกอบด้วย:
  * กุญแจสาธารณะ
  * ข้อมูลเจ้าของ
  * ข้อมูลผู้ออกใบรับรอง
  * ระยะเวลาที่มีผลบังคับใช้
  * ลายมือชื่อดิจิทัลจาก CA

#### 4.3 การสร้างคำขอใบรับรอง (Certificate Signing Request - CSR)
```bash
openssl req -new -key private_key.pem -out request.csr
```

**กิจกรรม:** ให้นักศึกษาสร้างคำขอใบรับรองและอภิปรายว่า CA จะตรวจสอบตัวตนก่อนออกใบรับรองอย่างไร (5 นาที)

---

## สรุป (5 นาที)
- ทบทวนความแตกต่างระหว่างการเข้ารหัสแบบสมมาตรและอสมมาตร
- ทบทวนวิธีการทำงานของลายมือชื่อดิจิทัล
- อภิปรายความสำคัญของ PKI ในการสร้างความเชื่อใจบนอินเทอร์เน็ต
- ตัวอย่างการใช้งานในชีวิตประจำวัน: HTTPS, อีเมล์ที่มีการเข้ารหัส, เอกสารอิเล็กทรอนิกส์ที่มีลายมือชื่อ

## การประยุกต์ใช้ในโลกจริง
- SSL/TLS สำหรับเว็บไซต์ (HTTPS)
- การลงนามในโค้ดซอฟต์แวร์
- การเข้ารหัสอีเมล์ (PGP/GPG)
- บัตรสมาร์ทการ์ด
- ระบบเอกสารอิเล็กทรอนิกส์

---

## ทรัพยากรเพิ่มเติม
1. คู่มือ OpenSSL: [https://www.openssl.org/docs/](https://www.openssl.org/docs/)
2. แนวคิดเกี่ยวกับการเข้ารหัสแบบอสมมาตร: [https://th.wikipedia.org/wiki/การเข้ารหัสลับแบบอสมมาตร](https://th.wikipedia.org/wiki/การเข้ารหัสลับแบบอสมมาตร)
3. มาตรฐาน X.509 สำหรับใบรับรองดิจิทัล: [https://tools.ietf.org/html/rfc5280](https://tools.ietf.org/html/rfc5280)
